<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="apple-touch-fullscreen" content="YES" />
<meta name="format-detection" content="telephone=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta http-equiv="Expires" content="-1" />
<meta http-equiv="pragram" content="no-cache" />

<link href="static/style.css" type="text/css" rel="stylesheet"/>

<title>Hun NHS Gashapon</title>
<!--version change -->
<script type="text/javascript">
    var phoneWidth =  parseInt(window.screen.width);
    var phoneScale = phoneWidth/640;
    var ua = navigator.userAgent;
    if (/Android (\d+\.\d+)/.test(ua)){
        var version = parseFloat(RegExp.$1);
        // andriod 2.3
        if(version>2.3){
            document.write('<meta name="viewport" content="width=640, minimum-scale = '+phoneScale+', maximum-scale = '+phoneScale+', target-densitydpi=device-dpi">');
        // andriod 2.3+
        }else{
            document.write('<meta name="viewport" content="width=640, target-densitydpi=device-dpi">');
        }
        // other systems
    } else {
        document.write('<meta name="viewport" content="width=640, user-scalable=no, target-densitydpi=device-dpi">');
    }
    //wechat
    if(RegExp("MicroMessenger").test(navigator.userAgent)){
        document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
            WeixinJSBridge.call('hideToolbar');
        });
	}
</script>
<script src="static/jquery1.8.3.min.js"></script>


</head>
<body>

<div class="niu_danji">
	<!--gashpon machine-->
	<div class="game_qu">
    	<!--go-->
        <div class="game_go">1 ticket/spin</div>
        <div class="wdjifen">NHS Gashapon</div>
    </div>
    
    <!--balls-->
    <div class="dan_gund">
        <span  class="qiu_1 diaol_1"></span>
        <span  class="qiu_2 diaol_2"> </span>
        <span  class="qiu_3 diaol_3"></span>
        
        <span  class="qiu_4 diaol_4"></span>
        <span  class="qiu_5 diaol_5"></span>
        <span  class="qiu_6 diaol_6"></span>>
        
        <span  class="qiu_7 diaol_7"></span>
        <span  class="qiu_8 diaol_8"></span>
        
        
        <span  class="qiu_9 diaol_9"></span>
        <span  class="qiu_10 diaol_10"></span> 
        <span  class="qiu_11 diaol_11"></span>   
               
    </div>

     <!--prize drop-->
   <div class="medon"><img src="static/mendong.png"/></div>
   <div class="zjdl ">
   		<span></span>
   </div>
    
   </div>




<!--if python returns 1-->
<div class="zonj_zezc none" id="jianpin_one">
	<div class="jpzs aiqiyi tc_anima">
    	<em><img src="static/close.png"/></em>
        <h2>
        	<b>Congrats！<br>You got a chocolate！</b>
        </h2>
	</div>
</div>

<!--if python returns -1-->
<div class="zonj_zezc none" id="jianpin_oneb">
	<div class="jpzs aiqiyi tc_anima">
    	<em><img src="static/close.png"/></em>
        <h2>
        	<b>This code has already been used and has given a chocolate!</b>
        </h2>
	</div>
</div>

<!--if python returns 2-->
<div class="zonj_zezc none"  id="jianpin_two">
	<div class="jpzs aiqiyi tc_anima">
    	<em><img src="static/close.png"/></em>
        <h2>
        	<b>Congrats！<br>You got a Starburst！</b>
        </h2>
    </div>
</div>

<!--if python returns -2-->
<div class="zonj_zezc none" id="jianpin_twob">
	<div class="jpzs aiqiyi tc_anima">
    	<em><img src="static/close.png"/></em>
        <h2>
        	<b>This code has already been used and has given a Starburst!</b>
        </h2>
	</div>
</div>

<!--if python returns 3-->
<div class="zonj_zezc none"  id="jianpin_three">
	<div class="jpzs aiqiyi tc_anima">
    	<em><img src="static/close.png"/></em>
        <h2>
        	<b>Congrats！<br>You got Z！</b>
        </h2>
    </div>
</div>


<!--if python returns 0-->
<div class="zonj_zezc none" id="jianpin_kong">
	<div class="jpzs aiqiyi tc_anima">
    	<em><img src="static/close.png"/></em>
        <h2>
        	<b>Sorry, please enter a valid code. </b>
        </h2>
    </div>
</div>


<!--zero points-->
<div class="zonj_zezc none" id="no_jifeng">
	<div class="jpzs aiqiyi tc_anima">
		<em><img src="static/close.png"/></em>
        <h2>
        	You are out of tickets！
        </h2>
    </div>
</div>


<script type="text/javascript">


$(document).ready(function(e) {
	//prize 1 close
	$("#jianpin_one em img").click(function(){
		$("#jianpin_one").hide();
		}
	);
	$("#jianpin_oneb em img").click(function(){
		$("#jianpin_oneb").hide();
		}
	);		
	//prize 2 close
	$("#jianpin_two em img").click(function(){
		$("#jianpin_two").hide();
		}
	);
	$("#jianpin_twob em img").click(function(){
		$("#jianpin_twob").hide();
		}
	);			
	//prize 3 close
	$("#jianpin_three em img").click(function(){
		$("#jianpin_three").hide();
		}
	);			
	//no prize
	$("#jianpin_kong em img").click(function(){
		$("#jianpin_kong").hide();
		}
	);			
	//no point
	$("#no_jifeng em img").click(function(){
		$("#no_jifeng").hide();
		}
	);		
		
//var score=100;
//$(".wdjifen").html(score);


$(".game_go").click(function(){
	draw()
		});
	
	
function draw(){
	//var number =Math.floor(4*Math.random()+1);  
	
	//my own code begins here (Eric)
	var code = prompt("Please enter your code for the Gashapon:")
	var outcome = -1 //-1 is our default value

	fetch(`${window.origin}/getcode`, {
		method: "POST",
		credentials: "include",
		body: JSON.stringify(code),
		cache: "no-cache",
		headers: new Headers({"content-type": "application/json"})
	})
	.then(function (response){
		if(response.status != 200){
			console.log(`Response code was not 200: ${response.status}`);
			return;
		} else {
			response.json().then(function(data){
				outcome = data
			})
		}
	})


	

	for(i=1;i<=11;i++){
			$(".qiu_"+i).removeClass("diaol_"+i);
			$(".qiu_"+i).addClass("wieyi_"+i);
		};
			
	setTimeout(function (){
		for(i=1;i<=11;i++){
		$(".qiu_"+i).removeClass("wieyi_"+i);
		}
	},1100);	
	setTimeout(function(){
		switch(outcome){
			case 0:$(".zjdl").children("span").addClass("diaL_zero");break;
			case 1:$(".zjdl").children("span").addClass("diaL_one");break;
			case 2:$(".zjdl").children("span").addClass("diaL_two");break;
			case 3:$(".zjdl").children("span").addClass("diaL_three");break;
			case 4:$(".zjdl").children("span").addClass("diaL_four");break;
		}
		$(".zjdl").removeClass("none").addClass("dila_Y");
				setTimeout(function (){
				switch(outcome){
					case 0:$("#jianpin_kong").show();break;
					case 1:$("#jianpin_one").show();break;
					case -1:$("#jianpin_oneb").show();break;
					case 2:$("#jianpin_two").show();break;
					case -2:$("#jianpin_twob").show();break;
					case 3:$("#jianpin_three").show();break;
				}
			},900);
		},1100)
	
	//cancel animation
	setTimeout(function (){
			$(".zjdl").addClass("none").removeClass("dila_Y");
			//$(".wdjifen").html(score);
			$(".zjdl").children("span").removeAttr('class');
			
		},2500)
			
}	
});


</script>
<script type="text/javascript">

</script>

</body>
</html>
